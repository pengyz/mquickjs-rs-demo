// Generated symbol references for RIDL extensions
//
// This file is generated in the aggregator crate (mquickjs-demo) and must not
// `use crate::generated::glue::*`, otherwise it can cause duplicate symbol
// definitions. Instead, we declare all glue entrypoints as extern symbols and
// take their addresses to force the linker to keep them.

use mquickjs_rs::mquickjs_ffi::{JSContext, JSValue};

{%- for function in functions %}
unsafe extern "C" {
    fn js_{{ function.name|lower }}(ctx: *mut JSContext, this_val: JSValue, argc: i32, argv: *mut JSValue) -> JSValue;
}
{%- endfor %}

{%- for interface in interfaces %}
{%- for method in interface.methods %}
unsafe extern "C" {
    fn js_{{ interface.name|lower }}_{{ method.name|lower }}(ctx: *mut JSContext, this_val: JSValue, argc: i32, argv: *mut JSValue) -> JSValue;
}
{%- endfor %}
{%- endfor %}

pub fn ensure_symbols() {
{%- for function in functions %}
    let _ = js_{{ function.name|lower }} as unsafe extern "C" fn(*mut JSContext, JSValue, i32, *mut JSValue) -> JSValue;
{%- endfor %}
{%- for interface in interfaces %}
{%- for method in interface.methods %}
    let _ = js_{{ interface.name|lower }}_{{ method.name|lower }} as unsafe extern "C" fn(*mut JSContext, JSValue, i32, *mut JSValue) -> JSValue;
{%- endfor %}
{%- endfor %}
}
