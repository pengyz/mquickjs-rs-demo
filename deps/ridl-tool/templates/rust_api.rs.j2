// Auto-generated Rust API (traits/types) for RIDL module: {{ module_name }}
//
// IMPORTANT:
// - This file is generated into OUT_DIR and is not meant to be edited.
// - User implementations should live in the module crate sources (e.g. src/impls.rs or ../<module>_impl.rs).
// - This file must remain free of JSValue conversion glue. Keep it as pure Rust declarations.

#[allow(non_snake_case, non_camel_case_types, non_upper_case_globals)]

{%- for itf in interfaces %}
// Interface {{ itf.name }}
pub trait {{ itf.name|to_upper_camel_case }}Interface {
    {%- for method in itf.methods %}
    fn {{ method.name|to_snake_case }}(
        &mut self,
        {%- for p in method.params %}
        {%- if p.variadic %}
        {{ p.name|lower }}: Vec<{{ p.rust_ty|safe }}>
        {%- else %}
        {{ p.name|lower }}: {{ p.rust_ty|safe }}{%- if !loop.last %}, {% endif %}
        {%- endif %}
        {%- endfor %}
    ) -> {%- if method.return_type == Type::Any -%}
        mquickjs_rs::handles::global::Global<mquickjs_rs::handles::local::Value>
    {%- else -%}
        {{ method.return_rust_ty|safe }}
    {%- endif -%};
    {%- endfor %}
}
{%- endfor %}

{%- for s in singletons %}
// Singleton {{ s.name }}
pub trait {{ s.name|to_upper_camel_case }}Singleton {
    {%- for method in s.methods %}
    fn {{ method.name|to_snake_case }}(
        &mut self,
        {%- for p in method.params %}
        {%- if p.variadic %}
        {{ p.name|lower }}: Vec<{{ p.rust_ty|safe }}>
        {%- else %}
        {{ p.name|lower }}: {{ p.rust_ty|safe }}{%- if !loop.last %}, {% endif %}
        {%- endif %}
        {%- endfor %}
    ) -> {%- if method.return_type == Type::Any -%}
        mquickjs_rs::handles::global::Global<mquickjs_rs::handles::local::Value>
    {%- else -%}
        {{ method.return_rust_ty|safe }}
    {%- endif -%};
    {%- endfor %}

    {%- for prop in s.properties %}
    {%- if prop.modifiers|is_readonly_prop %}
    fn {{ prop.name|to_snake_case }}(&self) -> {{ prop.property_type|rust_type_from_idl|safe }};
    {%- endif %}
    {%- endfor %}
}
{%- endfor %}

// Complex type declarations generated from RIDL.

{%- if union_types_by_domain.len() > 0 %}
{%- for d in union_types_by_domain %}
pub mod {{ d.domain }} {
    pub mod union {
{%- for u in d.unions %}
        pub enum {{ u.name }} {
{%- for m in u.members %}
            {{ m.variant }}({{ m.rust_ty }}),
{%- endfor %}
        }
{%- endfor %}
    }
}
{%- endfor %}
{%- endif %}

// TODO(complex-types): future struct/enum/type alias declarations generated from RIDL.
// Current policy: complex types are mapped to `any(JSValue)` in v1 and are passed through.

// -----------------------------------------------------------------------------
// RIDL class API (traits + proto FFI declarations)
// -----------------------------------------------------------------------------

{%- for class in classes %}

// Class {{ class.name }}
pub trait {{ class.name|to_upper_camel_case }}Class {
{%- for method in class.methods %}
    fn {{ method.name|to_snake_case }}(
        &mut self,
        {%- for p in method.params %}
        {{ p.name|lower }}: {{ p.rust_ty|safe }}{%- if !loop.last %}, {% endif %}
        {%- endfor %}
    ) -> {%- if method.return_type == Type::Any -%}
        mquickjs_rs::handles::global::Global<mquickjs_rs::handles::local::Value>
    {%- else -%}
        {{ method.return_rust_ty|safe }}
    {%- endif -%};
{%- endfor %}

{%- for prop in class.properties %}
{%- if !(prop.modifiers|is_proto_prop) %}
{%- if prop.modifiers|is_readonly_prop %}
    fn get_{{ prop.name|to_snake_case }}(&mut self) -> {{ prop.property_type|rust_type_from_idl }};
{%- else %}
    fn get_{{ prop.name|to_snake_case }}(&mut self) -> {{ prop.property_type|rust_type_from_idl }};
    fn set_{{ prop.name|to_snake_case }}(&mut self, v: {{ prop.property_type|rust_type_from_idl }});
{%- endif %}
{%- endif %}
{%- endfor %}

}

{%- if class.properties|any_proto_props %}

/// Per-context class prototype shared state (erased).
///
/// Module must provide these functions for each class that has proto properties.
pub type {{ class.name|to_upper_camel_case }}ProtoState = core::ffi::c_void;

unsafe extern "C" {
    pub fn ridl_create_proto_{{ class.name|to_snake_case }}() -> *mut {{ class.name|to_upper_camel_case }}ProtoState;
    pub fn ridl_drop_proto_{{ class.name|to_snake_case }}(p: *mut {{ class.name|to_upper_camel_case }}ProtoState);
}

{%- for prop in class.properties %}
{%- if prop.modifiers|is_proto_prop %}
{%- if prop.modifiers|is_readonly_prop %}
unsafe extern "C" {
    pub fn ridl_proto_get_{{ class.name|to_snake_case }}_{{ prop.name|to_snake_case }}(
        proto: *mut {{ class.name|to_upper_camel_case }}ProtoState,
    ) -> *const core::ffi::c_char;
}
{%- else %}
unsafe extern "C" {
    pub fn ridl_proto_get_{{ class.name|to_snake_case }}_{{ prop.name|to_snake_case }}(
        proto: *mut {{ class.name|to_upper_camel_case }}ProtoState,
    ) -> *const core::ffi::c_char;
}

unsafe extern "C" {
    pub fn ridl_proto_set_{{ class.name|to_snake_case }}_{{ prop.name|to_snake_case }}(
        proto: *mut {{ class.name|to_upper_camel_case }}ProtoState,
        v: *const core::ffi::c_char,
    );
}
{%- endif %}
{%- endif %}
{%- endfor %}
{%- endif %}

{%- endfor %}
