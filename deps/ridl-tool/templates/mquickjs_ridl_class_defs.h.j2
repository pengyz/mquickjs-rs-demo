/*
 * Auto-generated RIDL class definitions (C-side).
 *
 * This header is included by the RIDL aggregation header and is consumed by the
 * mquickjs ROM build tool.
 */

{%- for module in modules %}
{%- for class in module.classes %}

/* {{ class.module_name }}::{{ class.name }} */

JSValue js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_constructor(
    JSContext *ctx,
    JSValue *this_val,
    int argc,
    JSValue *argv
);

void js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_finalizer(
    JSContext *ctx,
    void *opaque
);

{%- for method in class.methods %}
JSValue js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_{{ method.name|lower }}(
    JSContext *ctx,
    JSValue *this_val,
    int argc,
    JSValue *argv
);
{%- endfor %}

{%- for prop in class.properties %}
{%- if prop.modifiers|is_proto_prop %}
JSValue js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_get_proto_{{ prop.name|lower }}(
    JSContext *ctx,
    JSValue *this_val,
    int argc,
    JSValue *argv
);
{%- if !(prop.modifiers|is_readonly_prop) %}
JSValue js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_set_proto_{{ prop.name|lower }}(
    JSContext *ctx,
    JSValue *this_val,
    int argc,
    JSValue *argv
);
{%- endif %}
{%- else %}
JSValue js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_get_{{ prop.name|lower }}(
    JSContext *ctx,
    JSValue *this_val,
    int argc,
    JSValue *argv
);
{%- if !(prop.modifiers|is_readonly_prop) %}
JSValue js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_set_{{ prop.name|lower }}(
    JSContext *ctx,
    JSValue *this_val,
    int argc,
    JSValue *argv
);
{%- endif %}
{%- endif %}
{%- endfor %}

static const JSPropDef js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_proto_funcs[] = {
{%- for method in class.methods %}
    JS_CFUNC_DEF("{{ method.name }}", {{ method.params|length }}, js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_{{ method.name|lower }}),
{%- endfor %}
{%- for prop in class.properties %}
{%- if prop.modifiers|is_proto_prop %}
{%- if prop.modifiers|is_readonly_prop %}
    JS_CGETSET_DEF("{{ prop.name }}", js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_get_proto_{{ prop.name|lower }}, NULL),
{%- else %}
    JS_CGETSET_DEF("{{ prop.name }}", js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_get_proto_{{ prop.name|lower }}, js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_set_proto_{{ prop.name|lower }}),
{%- endif %}
{%- else %}
{%- if prop.modifiers|is_readonly_prop %}
    JS_CGETSET_DEF("{{ prop.name }}", js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_get_{{ prop.name|lower }}, NULL),
{%- else %}
    JS_CGETSET_DEF("{{ prop.name }}", js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_get_{{ prop.name|lower }}, js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_set_{{ prop.name|lower }}),
{%- endif %}
{%- endif %}
{%- endfor %}
    JS_PROP_END,
};

static const JSClassDef js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_class_def =
    JS_CLASS_DEF(
        "{{ class.name }}",
        {{ class.methods|length }},
        js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_constructor,
        JS_CLASS_{{ class.module_name|normalize_ident|upper }}_{{ class.name|normalize_ident|upper }},
        NULL,
        js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_proto_funcs,
        NULL,
        js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_finalizer
    );

// Keep-alive symbol referenced from Rust aggregated_symbols.
void js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_class(void) {
    (void)&js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_class_def;
    (void)&js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_proto_funcs;
    (void)&js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_constructor;
    (void)&js_{{ class.module_name|normalize_ident|lower }}_class_{{ class.name|lower }}_finalizer;
}

{%- endfor %}
{%- endfor %}
